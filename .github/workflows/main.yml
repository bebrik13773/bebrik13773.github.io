on:
  push:
    branches:
      - '**'  # Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð¿Ñ€Ð¸ push Ð² Ð»ÑŽÐ±ÑƒÑŽ Ð²ÐµÑ‚ÐºÑƒ
  workflow_dispatch:  # Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº
    inputs:
      target_environment:
        description: 'Target environment'
        required: true
        default: 'test'
        type: choice
        options:
          - test
          - production

name: ðŸš€ Deploy website

jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v3
      
    - name: ðŸ” Determine deployment directory
      id: deployment
      run: |
        # Ð”Ð»Ñ Ñ€ÑƒÑ‡Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
        if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
          if [ "${{ inputs.target_environment }}" == "production" ]; then
            echo "target_dir=htdocs/" >> $GITHUB_OUTPUT
            echo "env_name=Production" >> $GITHUB_OUTPUT
          else
            echo "target_dir=htdocs/test/" >> $GITHUB_OUTPUT
            echo "env_name=Test" >> $GITHUB_OUTPUT
          fi
        # Ð”Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ push Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²ÐµÑ‚ÐºÑƒ
        else
          if [ "${{ github.ref }}" == "refs/heads/main" ]; then
            echo "target_dir=htdocs/" >> $GITHUB_OUTPUT
            echo "env_name=Production" >> $GITHUB_OUTPUT
          else
            echo "target_dir=htdocs/test/" >> $GITHUB_OUTPUT
            echo "env_name=Test" >> $GITHUB_OUTPUT
          fi
        fi
        echo "branch_name=${GITHUB_REF#refs/heads/}" >> $GITHUB_OUTPUT
      
    - name: ðŸ“¦ Deploy to ${{ steps.deployment.outputs.env_name }}
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.server }}
        username: ${{ secrets.username }}
        password: ${{ secrets.password }}
        local-dir: ./ÐšÐ¾Ð´/
        server-dir: ${{ steps.deployment.outputs.target_dir }}
        
    - name: âœ… Deployment Summary
      run: |
        echo "### ðŸŽ‰ Deployment Successful!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **Branch:** ${{ steps.deployment.outputs.branch_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Environment:** ${{ steps.deployment.outputs.env_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Target Directory:** ${{ steps.deployment.outputs.target_dir }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Trigger:** ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        if [ "${{ steps.deployment.outputs.env_name }}" == "Production" ]; then
          echo "ðŸŒ **Live URL:** https://bober-api.gt.tc/" >> $GITHUB_STEP_SUMMARY
        else
          echo "ðŸ§ª **Test URL:** https://bober-api.gt.tc/test/" >> $GITHUB_STEP_SUMMARY
        fi