on: push
name: ðŸš€ Deploy website on push

jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ðŸš¨ Get latest code
      uses: actions/checkout@v3
      
    - name: ðŸ” Determine deployment directory
      id: deployment
      run: |
        if [ "${{ github.ref }}" == "refs/heads/main" ]; then
          echo "target_dir=htdocs/" >> $GITHUB_OUTPUT
          echo "env_name=Production" >> $GITHUB_OUTPUT
        else
          echo "target_dir=htdocs/test/" >> $GITHUB_OUTPUT
          echo "env_name=Test" >> $GITHUB_OUTPUT
        fi
        echo "branch_name=${GITHUB_REF#refs/heads/}" >> $GITHUB_OUTPUT
      
    - name: ðŸ“¦ Deploy to ${{ steps.deployment.outputs.env_name }}
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.server }}
        username: ${{ secrets.username }}
        password: ${{ secrets.password }}
        local-dir: ./ÐšÐ¾Ð´/
        server-dir: ${{ steps.deployment.outputs.target_dir }}
        
    - name: âœ… Deployment Summary
      run: |
        echo "### ðŸŽ‰ Deployment Successful!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **Branch:** ${{ steps.deployment.outputs.branch_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Environment:** ${{ steps.deployment.outputs.env_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Target Directory:** ${{ steps.deployment.outputs.target_dir }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        if [ "${{ github.ref }}" == "refs/heads/main" ]; then
          echo "ðŸŒ **Live URL:** https://bober-api.gt.tc/" >> $GITHUB_STEP_SUMMARY
        else
          echo "ðŸ§ª **Test URL:** https://bober-api.gt.tc/test/" >> $GITHUB_STEP_SUMMARY
        fi